<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIVRA - Война (Казино Версия)</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* Custom styles from original file (retained for consistency) */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        .gradient-text {
            background: linear-gradient(90deg, #f7b733, #fc4a1a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-primary {
            background: linear-gradient(90deg, #f7b733, #fc4a1a);
            transition: all 0.2s ease-out;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(247, 183, 51, 0.2);
        }
        .btn-primary:active {
            transform: translateY(0) scale(0.98);
            box-shadow: none;
        }
        .btn-primary:disabled {
            background: #4a4a6a;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
            opacity: 0.7;
        }
        .btn-secondary {
            background-color: #4a4a6a;
            transition: all 0.2s ease-out;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #5a5a7a;
            transform: translateY(-2px);
        }
        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Green Felt Table (retained) */
        .game-board {
            background-color: #064e3b;
            background-image: radial-gradient(ellipse at center, #108a44 0%, #064e3b 80%);
            border: 1px solid #f7b733;
            position: relative;
            overflow: hidden;
        }
        
        /* Faint Branding on Table (retained) */
        .game-board::before {
            content: 'NIVRA';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.05);
            pointer-events: none;
            z-index: 0;
        }
        
        .card {
            width: 110px;
            height: 160px;
            background-color: #f8f9fa;
            color: #1a1a2e;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-weight: 600;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            border: 1px solid #aaa;
            transform: scale(0);
            animation-name: deal-card;
            animation-duration: 0.5s;
            animation-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation-fill-mode: forwards;
        }

        @keyframes deal-card {
            from { opacity: 0; transform: translateY(60px) rotateX(-30deg) rotateZ(15deg) scale(0.7); }
            to { opacity: 1; transform: translateY(0) rotateX(0) rotateZ(0) scale(1); }
        }
        
        .card.red { color: #c0392b; }
        .card-rank { font-size: 1.75rem; font-weight: 700; }
        .card-suit { font-size: 1.5rem; }
        .card-suit-center { font-size: 3.5rem; }
        
        .card .top-left { position: absolute; top: 8px; left: 10px; text-align: center; line-height: 1; }
        .card .bottom-right { position: absolute; bottom: 8px; right: 10px; transform: rotate(180deg); text-align: center; line-height: 1; }
        
        /* Branded Card Back (retained) */
        .card.facedown {
            background: linear-gradient(135deg, #fc4a1a, #f7b733);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .card.facedown::before {
            content: 'NIVRA';
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            color: rgba(255, 255, 255, 0.85);
            transform: rotate(-45deg);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .card.facedown > div { display: none; }
        
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="antialiased">

    <!-- Simple Header -->
    <header class="bg-gray-900 shadow-lg">
        <nav class="container mx-auto px-6 py-4 flex justify-center md:justify-start">
            <a href="#" class="text-3xl font-bold gradient-text">NIVRA CASINO</a>
        </nav>
    </header>

    <main class="min-h-[calc(100vh-160px)] flex items-center justify-center py-12 px-4">
        <!-- War Game Section -->
        <section id="war-game-container" class="w-full max-w-6xl">
            <div class="bg-gray-900 rounded-2xl shadow-2xl p-6 md:p-8 flex flex-col md:flex-row gap-8">
                
                <!-- Left Panel - Controls -->
                <div class="w-full md:w-1/3 lg:w-1/4 bg-gray-800 p-6 rounded-xl flex flex-col z-10">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">Война</h3>
                        <div class="text-lg font-semibold">
                            <i class="fas fa-wallet text-yellow-400"></i>
                            <span id="balance-display">1000.00</span>
                        </div>
                    </div>

                    <!-- Bet Amount -->
                    <div class="mb-4">
                        <label for="bet-amount" class="block text-sm font-medium text-gray-400 mb-1">Залог</label>
                        <input type="number" id="bet-amount" value="10" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all">
                    </div>

                    <!-- Game Status -->
                    <div class="bg-gray-700 rounded-lg p-4 mb-6 text-center h-24 flex items-center justify-center">
                        <p id="game-status-display" class="text-xl font-bold text-yellow-400">Направете залог</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-auto space-y-3">
                        <button id="action-btn" class="w-full py-4 rounded-lg text-black font-bold text-xl btn-primary">
                            Заложи и Играй
                        </button>
                        <div id="war-actions" class="grid grid-cols-2 gap-3 hidden">
                             <button id="war-btn" class="w-full py-3 rounded-lg text-white font-bold text-lg btn-secondary bg-red-700 hover:bg-red-600">Към Война</button>
                             <button id="surrender-btn" class="w-full py-3 rounded-lg text-white font-bold text-lg btn-secondary">Предай се</button>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Game Board -->
                <div class="w-full md:w-2/3 lg:w-3/4 flex items-center justify-center">
                    <div class="game-board w-full rounded-xl p-4 md:p-6 flex flex-col justify-around gap-8 min-h-[450px]">
                        
                        <!-- Dealer's Side -->
                        <div class="text-center">
                             <h4 class="text-xl font-semibold mb-2">Дилър</h4>
                            <div id="dealer-cards" class="flex justify-center items-center gap-4 min-h-[180px]">
                                <!-- Dealer cards appear here -->
                            </div>
                        </div>

                        <!-- Player's Side -->
                        <div class="text-center">
                            <div id="player-cards" class="flex justify-center items-center gap-4 min-h-[180px] mb-2">
                                <!-- Player cards appear here -->
                            </div>
                            <h4 class="text-xl font-semibold">Ти</h4>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Simple Footer -->
    <footer class="bg-gray-900 text-gray-500 text-center py-6">
        <p class="text-xs">Играта е предназначена само за забавление за лица над 18 години. Използват се виртуални кредити без реална стойност.</p>
        <p class="text-sm mt-2">&copy; 2024 NIVRA. Всички права запазени.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ======================= CASINO WAR GAME LOGIC =======================
            
            // DOM Elements
            const balanceDisplay = document.getElementById('balance-display');
            const betAmountInput = document.getElementById('bet-amount');
            const gameStatusDisplay = document.getElementById('game-status-display');
            const actionBtn = document.getElementById('action-btn');
            const warActions = document.getElementById('war-actions');
            const warBtn = document.getElementById('war-btn');
            const surrenderBtn = document.getElementById('surrender-btn');
            const dealerCardsContainer = document.getElementById('dealer-cards');
            const playerCardsContainer = document.getElementById('player-cards');
            
            // Game State
            let balance = 1000.00;
            let deck = [];
            let currentBet = 0;

            // --- Game Setup ---
            function createDeck() {
                const suits = ['♥', '♦', '♣', '♠'];
                const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
                let newDeck = [];
                for (const suit of suits) {
                    for (const rank of ranks) {
                        let value = ranks.indexOf(rank) + 2; // 2=2, 3=3, ..., A=14
                        newDeck.push({ suit, rank, value });
                    }
                }
                // Shuffle Deck
                for (let i = newDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newDeck[i], newDeck[j]] = [newDeck[j], newDeck[i]];
                }
                return newDeck;
            }

            function ensureDeck() {
                // If deck has less than 10 cards, reshuffle.
                if (deck.length < 10) {
                    deck = createDeck();
                    // You could add a status message here like "Разбъркване на тестето..."
                }
            }

            // --- UI Functions ---
            function updateBalanceDisplay() {
                balanceDisplay.textContent = balance.toFixed(2);
            }

            function renderCard(card, container, delay = 0) {
                const cardEl = document.createElement('div');
                cardEl.classList.add('card');
                cardEl.style.animationDelay = `${delay}ms`;
                cardEl.innerHTML = `
                    <div class="top-left"><div class="card-rank">${card.rank}</div><div class="card-suit">${card.suit}</div></div>
                    <div class="card-suit-center flex-grow flex items-center justify-center">${card.suit}</div>
                    <div class="bottom-right"><div class="card-rank">${card.rank}</div><div class="card-suit">${card.suit}</div></div>
                `;
                if (['♥', '♦'].includes(card.suit)) cardEl.classList.add('red');
                container.appendChild(cardEl);
            }
            
            function setStatus(message, colorClass = 'text-yellow-400') {
                gameStatusDisplay.textContent = message;
                gameStatusDisplay.className = `text-xl font-bold transition-colors duration-300 ${colorClass}`;
            }

            function setUiState(state) {
                betAmountInput.disabled = (state !== 'pre-game');
                actionBtn.classList.toggle('hidden', state !== 'pre-game');
                warActions.classList.toggle('hidden', state !== 'war-decision');
            }

            function clearBoard() {
                playerCardsContainer.innerHTML = '';
                dealerCardsContainer.innerHTML = '';
            }

            function flashInputBorder(inputElement) {
                inputElement.classList.add('border-red-500', 'ring-red-500');
                setTimeout(() => inputElement.classList.remove('border-red-500', 'ring-red-500'), 1000);
            }
            
            // --- Game Logic Functions ---
            function playRound() {
                const bet = parseFloat(betAmountInput.value);
                if (isNaN(bet) || bet <= 0 || bet > balance) {
                    flashInputBorder(betAmountInput);
                    setStatus('Невалиден залог!', 'text-red-400');
                    return;
                }
                
                currentBet = bet;
                balance -= currentBet;
                updateBalanceDisplay();
                setUiState('animation');
                clearBoard();
                setStatus('Раздаване...', 'text-white');

                ensureDeck();
                const playerCard = deck.pop();
                const dealerCard = deck.pop();
                
                renderCard(playerCard, playerCardsContainer, 0);
                renderCard(dealerCard, dealerCardsContainer, 150);
                
                setTimeout(() => compareCards(playerCard, dealerCard), 1200);
            }

            function compareCards(playerCard, dealerCard) {
                if (playerCard.value > dealerCard.value) {
                    endRound(currentBet * 2, 'Ти печелиш!', 'text-green-400');
                } else if (dealerCard.value > playerCard.value) {
                    endRound(0, 'Дилърът печели!', 'text-red-400');
                } else {
                    setStatus('ВОЙНА! Направи избор.', 'text-yellow-400');
                    setUiState('war-decision');
                }
            }
            
            function handleWar() {
                if (balance < currentBet) {
                    setStatus('Нямаш пари за война! Предаваш се.', 'text-red-400');
                    handleSurrender();
                    return;
                }

                balance -= currentBet; // Place second bet for war
                updateBalanceDisplay();
                setUiState('animation');
                setStatus('Война! Раздаване отново...', 'text-white');

                // Burn 3 cards and deal the 4th, as per common casino rules.
                ensureDeck();
                // Simple version: just draw one more card each.
                const playerWarCard = deck.pop();
                const dealerWarCard = deck.pop();

                setTimeout(() => {
                    clearBoard();
                    renderCard(playerWarCard, playerCardsContainer, 0);
                    renderCard(dealerWarCard, dealerCardsContainer, 150);

                    setTimeout(() => {
                        // In case of a second tie, player usually wins.
                        if (playerWarCard.value >= dealerWarCard.value) {
                             endRound(currentBet * 4, 'ПЕЧЕЛИШ ВОЙНАТА!', 'text-green-400');
                        } else {
                             endRound(0, 'Губиш войната.', 'text-red-400');
                        }
                    }, 1200);
                }, 1000);
            }

            function handleSurrender() {
                 endRound(currentBet * 0.5, 'Предаде се. Връщаш си половината.', 'text-gray-400');
            }
            
            function endRound(payout, message, colorClass) {
                balance += payout;
                setStatus(message, colorClass);
                updateBalanceDisplay();
                
                // Wait a bit before resetting UI so player can see the result
                setTimeout(() => {
                    setUiState('pre-game');
                     if (balance > 0) {
                        setStatus('Направете нов залог', 'text-yellow-400');
                    } else {
                        setStatus('Нямате кредити. Презаредете страницата.', 'text-red-500');
                        betAmountInput.disabled = true;
                        actionBtn.disabled = true;
                    }
                }, 2000);
            }

            // --- Initial Setup ---
            function init() {
                deck = createDeck();
                updateBalanceDisplay();
                actionBtn.addEventListener('click', playRound);
                warBtn.addEventListener('click', handleWar);
                surrenderBtn.addEventListener('click', handleSurrender);
            }

            init();
        });
    </script>
</body>
</html>